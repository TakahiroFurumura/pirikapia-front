import{b as G,c as J,Q as K}from"./interfaces-Cis-Z6rM.js";import{Q as S}from"./QBtn-BI7bDBvB.js";import{Q as $}from"./QCardSection-BXxWNfpf.js";import{K as H,B as W,a as n,r as s,x as X,w as Y,O as v,D as l,R as I,G as u,F as h,S as Z,E as a,L as T,M as ee,N as p,C as w,I as k,J as c,P as te}from"./index-EMGvw2OY.js";import{u as oe,a as q}from"./axios-DXJKcBBz.js";const ae=H("uiConfigStore",{state:()=>({debugMode:!0,language:"jp"}),getters:{getLanguage:i=>i.language,isDebugMode:i=>i.debugMode},actions:{}}),re={key:0},ne={class:"row"},le={class:"text-caption q-ml-sm"},me=W({__name:"ImageBox",props:{imageId:{},linkTo:{default:""},showTags:{type:Boolean,default:!0},showPublishedDate:{type:Boolean,default:!0},showButtons:{type:Boolean,default:!0},cropAspectRatio:{default:null},heightPercent:{},fit:{}},setup(i){const A=ae().isDebugMode,_=oe(),x=ee(),Q=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}),o=i,R=o.fit?o.fit:"cover",M=n(()=>o.heightPercent!==null&&o.heightPercent!==void 0?`${o.heightPercent}%`:"none"),t=s(null),C=s(!1),y=s(null),b=s([]),P=n(()=>t.value?.created_on?Q.format(new Date(t.value?.created_on)):""),F=n(()=>0),L=n(()=>t.value!==null?t.value.owner_username:""),N=n(()=>o.cropAspectRatio!==null&&o.cropAspectRatio!==void 0?o.cropAspectRatio:t.value!==null&&t.value.width!==void 0&&t.value.height!==void 0?t.value.width/t.value.height:1),d=s(!1),g=s(!1),E=n(()=>d.value||g.value||B.value>0?"favorite":"favorite_border"),V=n(()=>d.value||g.value?"pink":"primary"),B=n(()=>t.value!=null&&t.value!==null?t.value.bookmark_count+(g.value?1:0):0);function j(e){return`/?tag=${e}`}const z=async()=>{await q.get(`/images/hashid/${o.imageId}/`).then(e=>{t.value=e.data,b.value=Object.keys(e.data.tags),d.value=e.data.bookmark}).catch(e=>{console.log(e)})},D=async()=>{C.value=!0,y.value=null,t.value=null;try{await z()}catch(e){console.error("Failed to load an image:",e),e instanceof Error?y.value=e:y.value=new Error(String(e))}finally{C.value=!1}};function O(){d.value||t.value!==null&&(console.debug(`toggleBookmark ${t.value.filename} ${_.user}`),_.isAuthenticated?q.post(`/images/bookmark/${t.value.image_id}/`,{}).then(()=>{console.debug(`added to ${_.user.username} bookmark.`),g.value=!0}).catch(e=>{console.error(e.message)}):x.push("/user-login"))}X(()=>{A&&console.debug(o),D().catch(e=>console.error(e))}),Y(()=>o.imageId,(e,r)=>{e!==r&&e&&(console.log(`Image ID changed from ${r} to ${e}. Reloading data.`),D().catch(m=>console.error(m)))});function U(){return o.linkTo==""?`/image-detail-view/${o.imageId}`:o.linkTo}return(e,r)=>{const m=Z("router-link");return l(),v(I,null,[u(m,{to:U()},{default:a(()=>[u(G,{src:t.value?.signed_url,"spinner-color":"grey",ratio:N.value,"spinner-size":"82px",style:{position:"relative"},fit:T(R),height:M.value},{error:a(()=>r[1]||(r[1]=[p("div",{class:"absolute-full flex flex-center bg-grey text-white"}," Failed to load... ",-1)])),default:a(()=>[t.value?.requires_login?(l(),v("div",{key:0,class:"absolute-full text-subtitle1 flex flex-center",style:{cursor:"pointer","background-color":"rgba(0, 0, 0, 0.3)",color:"white",padding:"2px"},onClick:r[0]||(r[0]=f=>T(x).push("/user-login"))},r[2]||(r[2]=[p("span",{class:""},"Login to unlock",-1)]))):h("",!0)]),_:1},8,["src","ratio","fit","height"])]),_:1},8,["to"]),o.showButtons?(l(),v("div",re,[p("div",ne,[u(J,{align:"left",class:"q-mx-none q-pa-none q-my-none"},{default:a(()=>[u(S,{flat:"",round:"",size:"md",color:V.value,icon:E.value,class:"q-ml-none",onClick:O},{default:a(()=>[k(c(B.value),1)]),_:1},8,["color","icon"]),u(S,{flat:"",round:"",size:"md",color:"primary",icon:"comment",class:"q-ml-sm"},{default:a(()=>[k(c(F.value),1)]),_:1}),p("div",le,"by "+c(L.value),1)]),_:1}),o.showPublishedDate?(l(),w($,{key:0,class:"text-caption"},{default:a(()=>[k(c(P.value),1)]),_:1})):h("",!0)]),b.value.length>0&&o.showTags?(l(),w($,{key:0},{default:a(()=>[(l(!0),v(I,null,te(b.value,f=>(l(),w(K,{color:"primary","text-color":"white",key:f,class:"q-mx-xs q-px-sm"},{default:a(()=>[u(m,{to:j(f),style:{"text-decoration":"none",color:"white"}},{default:a(()=>[k(c(f.replace(/_/g," ")),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):h("",!0)])):h("",!0)],64)}}});export{me as _,ae as u};
