import{b as z,c as O,Q as P}from"./interfaces-Ec9u-xyp.js";import{Q as S}from"./QBtn-DLdoahvf.js";import{Q as I}from"./QCardSection-DljHQTJ0.js";import{Q as U}from"./QCard-CaLw-D77.js";import{K as G,B as J,r as s,a as l,x as K,w as H,C as v,D as n,E as a,G as u,O as w,F as p,S as W,L as X,M as Y,N as k,I as h,J as c,R as Z,P as ee}from"./index-D_uaF-qf.js";import{u as oe,a as Q}from"./axios-DgDyWnCa.js";const te=G("uiConfigStore",{state:()=>({debugMode:!0,language:"jp"}),getters:{getLanguage:i=>i.language,isDebugMode:i=>i.debugMode},actions:{}}),ae={key:0},re={class:"row"},le={class:"text-caption q-ml-sm"},ge=J({__name:"ImageBox",props:{imageId:{},linkTo:{default:""},showTags:{type:Boolean,default:!0},showPublishedDate:{type:Boolean,default:!0},showButtons:{type:Boolean,default:!0},cropAspectRatio:{default:null}},setup(i){const T=te().isDebugMode,_=oe(),x=Y(),$=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}),t=i,o=s(null),C=s(!1),y=s(null),b=s([]),q=l(()=>o.value?.created_on?$.format(new Date(o.value?.created_on)):""),A=l(()=>0),R=l(()=>o.value!==null?o.value.owner_username:""),M=l(()=>t.cropAspectRatio!==null&&t.cropAspectRatio!==void 0?t.cropAspectRatio:o.value!==null&&o.value.width!==void 0&&o.value.height!==void 0?o.value.width/o.value.height:1),d=s(!1),m=s(!1),F=l(()=>d.value||m.value||B.value>0?"favorite":"favorite_border"),L=l(()=>d.value||m.value?"pink":"primary"),B=l(()=>o.value!=null&&o.value!==null?o.value.bookmark_count+(m.value?1:0):0);function N(e){return`/?tag=${e}`}const E=async()=>{await Q.get(`/images/hashid/${t.imageId}/`).then(e=>{o.value=e.data,b.value=Object.keys(e.data.tags),d.value=e.data.bookmark}).catch(e=>{console.log(e)})},D=async()=>{C.value=!0,y.value=null,o.value=null;try{await E()}catch(e){console.error("Failed to load an image:",e),e instanceof Error?y.value=e:y.value=new Error(String(e))}finally{C.value=!1}};function V(){d.value||o.value!==null&&(console.debug(`toggleBookmark ${o.value.filename} ${_.user}`),_.isAuthenticated?Q.post(`/images/bookmark/${o.value.image_id}/`,{}).then(()=>{console.debug(`added to ${_.user.username} bookmark.`),m.value=!0}).catch(e=>{console.error(e.message)}):x.push("/user-login"))}K(()=>{T&&console.debug(t),D().catch(e=>console.error(e))}),H(()=>t.imageId,(e,r)=>{e!==r&&e&&(console.log(`Image ID changed from ${r} to ${e}. Reloading data.`),D().catch(g=>console.error(g)))});function j(){return t.linkTo==""?`/image-detail-view/${t.imageId}`:t.linkTo}return(e,r)=>{const g=W("router-link");return n(),v(U,{flat:""},{default:a(()=>[u(g,{to:j()},{default:a(()=>[u(z,{src:o.value?.signed_url,"spinner-color":"grey",ratio:M.value,"spinner-size":"82px",style:{position:"relative"}},{error:a(()=>r[1]||(r[1]=[k("div",{class:"absolute-full flex flex-center bg-grey text-white"}," Failed to load... ",-1)])),default:a(()=>[o.value?.requires_login?(n(),w("div",{key:0,class:"absolute-full text-subtitle1 flex flex-center",style:{cursor:"pointer","background-color":"rgba(0, 0, 0, 0.3)",color:"white",padding:"2px"},onClick:r[0]||(r[0]=f=>X(x).push("/user-login"))},r[2]||(r[2]=[k("span",{class:""},"Login to unlock",-1)]))):p("",!0)]),_:1},8,["src","ratio"])]),_:1},8,["to"]),t.showButtons?(n(),w("div",ae,[k("div",re,[u(O,{align:"left",class:"q-mx-none q-pa-none q-my-none"},{default:a(()=>[u(S,{flat:"",round:"",size:"md",color:L.value,icon:F.value,class:"q-ml-none",onClick:V},{default:a(()=>[h(c(B.value),1)]),_:1},8,["color","icon"]),u(S,{flat:"",round:"",size:"md",color:"primary",icon:"comment",class:"q-ml-sm"},{default:a(()=>[h(c(A.value),1)]),_:1}),k("div",le,"by "+c(R.value),1)]),_:1}),t.showPublishedDate?(n(),v(I,{key:0,class:"text-caption"},{default:a(()=>[h(c(q.value),1)]),_:1})):p("",!0)]),b.value.length>0&&t.showTags?(n(),v(I,{key:0},{default:a(()=>[(n(!0),w(Z,null,ee(b.value,f=>(n(),v(P,{color:"primary","text-color":"white",key:f,class:"q-mx-xs q-px-sm"},{default:a(()=>[u(g,{to:N(f),style:{"text-decoration":"none",color:"white"}},{default:a(()=>[h(c(f.replace(/_/g," ")),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):p("",!0)])):p("",!0)]),_:1})}}});export{ge as _,te as u};
