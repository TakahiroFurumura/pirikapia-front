import{Q as K,b as X}from"./interfaces-D9GRGoMu.js";import{Q as I}from"./QBtn-CZIcCi6_.js";import{Q as S}from"./QCardSection-D1bofxnj.js";import{Q as G}from"./QChip-CHiRG0CG.js";import{u as H}from"./uiconfig-t9C1pZ6V.js";import{u as W,a as T}from"./auth-XbfXqh8a.js";import{I as Y,a as n,r as i,w as $,F as Z,U as v,K as l,X as Q,N as u,M as h,Q as ee,L as r,R as w,S as te,T as p,J as x,O as k,P as c,V as oe}from"./index-DIZdvslo.js";const ae={key:0},re={class:"row"},ne={class:"text-caption q-ml-sm"},ge=Y({__name:"ImageBox",props:{imageId:{},linkTo:{default:""},showTags:{type:Boolean,default:!0},showPublishedDate:{type:Boolean,default:!0},showButtons:{type:Boolean,default:!0},cropAspectRatio:{default:null},heightPercent:{},fit:{}},setup(q){const A=H().isDebugMode,d=W(),B=te(),R=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}),o=q,P=o.fit?o.fit:"cover",F=n(()=>o.heightPercent!==null&&o.heightPercent!==void 0?`${o.heightPercent}%`:"none"),t=i(null),C=i(!1),_=i(null),y=i([]),N=n(()=>t.value?.created_on?R.format(new Date(t.value?.created_on)):""),V=n(()=>0),L=n(()=>t.value!==null?t.value.owner_username:""),M=n(()=>o.cropAspectRatio!==null&&o.cropAspectRatio!==void 0?o.cropAspectRatio:t.value!==null&&t.value.width!==void 0&&t.value.height!==void 0?t.value.width/t.value.height:1);$(()=>o.imageId,(e,a)=>{e!==a&&b().catch(s=>{console.error(s)})});const m=i(!1),f=i(!1),z=n(()=>m.value||f.value||D.value>0?"favorite":"favorite_border"),E=n(()=>m.value||f.value?"pink":"primary"),D=n(()=>t.value!=null&&t.value!==null?t.value.bookmark_count+(f.value?1:0):0);function O(e){return`/?tag=${e}`}const U=async()=>{await T.get(`/images/hashid/${o.imageId}/`).then(e=>{t.value=e.data,y.value=Object.keys(e.data.tags),m.value=e.data.bookmark}).catch(e=>{console.log(e)})},b=async()=>{C.value=!0,_.value=null,t.value=null;try{await U()}catch(e){console.error("Failed to load an image:",e),e instanceof Error?_.value=e:_.value=new Error(String(e))}finally{C.value=!1}};function j(){m.value||t.value!==null&&(console.debug(`toggleBookmark ${t.value.filename} ${d.user}`),d.isAuthenticated?T.post(`/images/bookmark/${t.value.image_id}/`,{}).then(()=>{console.debug(`added to ${d.user.username} bookmark.`),f.value=!0}).catch(e=>{console.error(e.message)}):B.push("/user-login"))}Z(()=>{A&&console.debug(o),b().catch(e=>console.error(e))}),$(()=>o.imageId,(e,a)=>{e!==a&&e&&(console.log(`Image ID changed from ${a} to ${e}. Reloading data.`),b().catch(s=>console.error(s)))});function J(){return o.linkTo==""?`/image-detail-view/${o.imageId}`:o.linkTo}return(e,a)=>{const s=ee("router-link");return l(),v(Q,null,[u(s,{to:J()},{default:r(()=>[u(K,{src:t.value?.signed_url,"spinner-color":"grey",ratio:M.value,"spinner-size":"82px",style:{position:"relative"},fit:w(P),height:F.value},{error:r(()=>a[1]||(a[1]=[p("div",{class:"absolute-full flex flex-center bg-grey text-white"}," Failed to load... ",-1)])),default:r(()=>[t.value?.requires_login&&!w(d).isAuthenticated?(l(),v("div",{key:0,class:"absolute-full text-subtitle1 flex flex-center",style:{cursor:"pointer","background-color":"rgba(0, 0, 0, 0.3)",color:"white",padding:"2px"},onClick:a[0]||(a[0]=g=>w(B).push("/user-login"))},a[2]||(a[2]=[p("span",{class:""},"Login to unlock",-1)]))):h("",!0)]),_:1},8,["src","ratio","fit","height"])]),_:1},8,["to"]),o.showButtons?(l(),v("div",ae,[p("div",re,[u(X,{align:"left",class:"q-mx-none q-pa-none q-my-none"},{default:r(()=>[u(I,{flat:"",round:"",size:"md",color:E.value,icon:z.value,class:"q-ml-none",onClick:j},{default:r(()=>[k(c(D.value),1)]),_:1},8,["color","icon"]),u(I,{flat:"",round:"",size:"md",color:"primary",icon:"comment",class:"q-ml-sm"},{default:r(()=>[k(c(V.value),1)]),_:1}),p("div",ne,"by "+c(L.value),1)]),_:1}),o.showPublishedDate?(l(),x(S,{key:0,class:"text-caption"},{default:r(()=>[k(c(N.value),1)]),_:1})):h("",!0)]),y.value.length>0&&o.showTags?(l(),x(S,{key:0},{default:r(()=>[(l(!0),v(Q,null,oe(y.value,g=>(l(),x(G,{color:"primary","text-color":"white",key:g,class:"q-mx-xs q-px-sm"},{default:r(()=>[u(s,{to:O(g),style:{"text-decoration":"none",color:"white"}},{default:r(()=>[k(c(g.replace(/_/g," ")),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):h("",!0)])):h("",!0)],64)}}});export{ge as _};
