import{a as B,b as F,Q as N,_ as T}from"./interfaces-BzCKrqBR.js";import{Q as h}from"./QCardSection-D-F8mFuF.js";import{Q as V}from"./QCard-BRXSi8pu.js";import{a as w}from"./axios-BF2LvLzg.js";import{B as L,r as m,a as O,b as R,w as M,O as s,G as d,F as _,E as i,N as y,S as x,Q as k,M as j,T as A,D as o,C as I,L as G,I as b,J as D}from"./index-BbEnxdqt.js";import"./QBtn-DsJGcRjh.js";import"./use-dark-Bva1yMBi.js";import"./use-timeout-CfW1dRvD.js";const J={class:"q-pa-md q-gutter-sm"},P={key:0,class:"row q-col-gutter-xs"},ee=L({__name:"ImageDetailView",props:{imageId:{}},setup(q){const C=j(),Q=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}),c=q,g=m([]),n=m(null),u=m(!1),r=m(null),f=m([]),S=O(()=>n.value?.created_on?Q.format(new Date(n.value?.created_on)):"");function $(e){return`/?tag=${e}`}const E=async()=>{await w.get(`images/hashid/${c.imageId}/`).then(e=>{n.value=e.data,f.value=Object.keys(e.data.tags)}).catch(e=>{console.log(e)})},p=async()=>{u.value=!0,r.value=null,n.value=null;try{const e=await E();console.log(e)}catch(e){console.error("画像詳細の取得に失敗しました:",e),e instanceof Error?r.value=e:r.value=new Error(String(e))}finally{u.value=!1}},v=async()=>{u.value=!0,r.value=null;try{let e;c.imageId!==null?(console.debug(c.imageId),e=`/images/similar/${c.imageId}/12/`):(console.error("loading random thumbnails instead of similar images"),e="/images/random-thumbnails/12/"),await w.get(e).then(t=>{const l=t.data;g.value=l.map(a=>B(a))})}catch(e){console.error("Failed to fetch image data:",e),e instanceof Error?r.value=e:r.value=new Error("An unknown error occurred")}finally{u.value=!1}};return R(()=>{p().catch(e=>console.error(e)),v().catch(e=>console.error(e))}),M(()=>c.imageId,(e,t)=>{e!==t&&e&&(console.log(`Image ID changed from ${t} to ${e}. Reloading data.`),p().then(()=>{v().catch(l=>console.error(l))}).catch(l=>console.error(l)))}),(e,t)=>{const l=A("router-link");return o(),s("div",J,[d(V,{flat:""},{default:i(()=>[d(F,{src:n.value?.signed_url,"spinner-color":"white",style:{"max-width":"1024px"}},{default:i(()=>[n.value?.requires_login?(o(),s("div",{key:0,class:"absolute-full text-subtitle1 flex flex-center",style:{cursor:"pointer","background-color":"rgba(0, 0, 0, 0.3)",color:"white",padding:"2px"},onClick:t[0]||(t[0]=a=>G(C).push("/user-login"))},t[1]||(t[1]=[y("span",{class:""},"Login to unlock",-1)]))):_("",!0)]),_:1},8,["src"]),f.value.length>0?(o(),I(h,{key:0},{default:i(()=>[(o(!0),s(x,null,k(f.value,a=>(o(),I(N,{color:"primary","text-color":"white",key:a,class:"q-mx-xs q-px-sm"},{default:i(()=>[d(l,{to:$(a),style:{"text-decoration":"none",color:"white"}},{default:i(()=>[b(D(a.replace(/_/g," ")),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):_("",!0),d(h,{class:"text-caption"},{default:i(()=>[b(D(S.value),1)]),_:1})]),_:1}),!u.value&&!r.value&&g.value.length>0?(o(),s("div",P,[t[2]||(t[2]=y("div",{class:"text-subtitle1 col-12"},"more like this",-1)),(o(!0),s(x,null,k(g.value,a=>(o(),s("div",{key:a.filename,class:"col-xs-12 col-sm-6 col-md-4 col-lg-3"},[d(T,{filename:a.filename,image_id:a.image_id,signed_url:a.signed_url,owner_username:a.owner_username,title:a.title,favorite_count:a.favorite_count,comment_count:a.comment_count,requires_login:a.requires_login},null,8,["filename","image_id","signed_url","owner_username","title","favorite_count","comment_count","requires_login"])]))),128))])):_("",!0)])}}});export{ee as default};
