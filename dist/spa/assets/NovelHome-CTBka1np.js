import{Q as K}from"./QSpinnerGears-DLyHiGtE.js";import{Q as W}from"./QPage-BZTPLb1b.js";import{K as X,B as $,r as v,a as h,x as S,w as Y,C as k,D as l,E as r,G as i,O as m,F as x,S as Z,L as ee,M as oe,N as s,I as C,J as u,R as D,P as N}from"./index-CeVLE_du.js";import{u as te,a as Q}from"./axios-DLKgpXoB.js";import{Q as ae}from"./QSeparator-DqAthEED.js";import{b as se,c as le,Q as ne,d as re}from"./interfaces-CDDY7A8t.js";import{Q as A}from"./QBtn-BO7GXa4O.js";import{Q as L}from"./QCardSection-BUAgQuQ-.js";import{Q as ie}from"./QCard-DNqce8Tc.js";import{_ as ue}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./render-Bi8UPygE.js";import"./use-dark-Dw7rn0m7.js";import"./use-router-link-BliwEbfi.js";import"./use-timeout-BjgPqHS9.js";const q=X("uiConfigStore",{state:()=>({debugMode:!0,language:"jp"}),getters:{getLanguage:c=>c.language,isDebugMode:c=>c.debugMode},actions:{}}),ce={key:0},de={class:"row"},me={class:"text-caption q-ml-sm"},F=$({__name:"ImageBox",props:{imageId:{},linkTo:{default:""},showTags:{type:Boolean,default:!0},showPublishedDate:{type:Boolean,default:!0},showButtons:{type:Boolean,default:!0},cropAspectRatio:{default:null}},setup(c){const p=q().isDebugMode,a=te(),_=oe(),b=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}),o=c,e=v(null),d=v(!1),n=v(null),B=v([]),P=h(()=>e.value?.created_on?b.format(new Date(e.value?.created_on)):""),V=h(()=>0),z=h(()=>e.value!==null?e.value.owner_username:""),E=h(()=>o.cropAspectRatio!==null&&o.cropAspectRatio!==void 0?o.cropAspectRatio:e.value!==null&&e.value.width!==void 0&&e.value.height!==void 0?e.value.width/e.value.height:1),y=v(!1),I=v(!1),j=h(()=>y.value||I.value||M.value>0?"favorite":"favorite_border"),O=h(()=>y.value||I.value?"pink":"primary"),M=h(()=>e.value!=null&&e.value!==null?e.value.bookmark_count+(I.value?1:0):0);function G(t){return`/?tag=${t}`}const H=async()=>{await Q.get(`/images/hashid/${o.imageId}/`).then(t=>{e.value=t.data,B.value=Object.keys(t.data.tags),y.value=t.data.bookmark}).catch(t=>{console.log(t)})},R=async()=>{d.value=!0,n.value=null,e.value=null;try{await H()}catch(t){console.error("Failed to load an image:",t),t instanceof Error?n.value=t:n.value=new Error(String(t))}finally{d.value=!1}};function U(){y.value||e.value!==null&&(console.debug(`toggleBookmark ${e.value.filename} ${a.user}`),a.isAuthenticated?Q.post(`/images/bookmark/${e.value.image_id}/`,{}).then(()=>{console.debug(`added to ${a.user.username} bookmark.`),I.value=!0}).catch(t=>{console.error(t.message)}):_.push("/user-login"))}S(()=>{p&&console.debug(o),R().catch(t=>console.error(t))}),Y(()=>o.imageId,(t,g)=>{t!==g&&t&&(console.log(`Image ID changed from ${g} to ${t}. Reloading data.`),R().catch(T=>console.error(T)))});function J(){return o.linkTo==""?`/image-detail-view/${o.imageId}`:o.linkTo}return(t,g)=>{const T=Z("router-link");return l(),k(ie,{flat:""},{default:r(()=>[i(T,{to:J()},{default:r(()=>[i(se,{src:e.value?.signed_url,"spinner-color":"grey",ratio:E.value,"spinner-size":"82px",style:{position:"relative"}},{error:r(()=>g[1]||(g[1]=[s("div",{class:"absolute-full flex flex-center bg-grey text-white"}," Failed to load... ",-1)])),default:r(()=>[e.value?.requires_login?(l(),m("div",{key:0,class:"absolute-full text-subtitle1 flex flex-center",style:{cursor:"pointer","background-color":"rgba(0, 0, 0, 0.3)",color:"white",padding:"2px"},onClick:g[0]||(g[0]=w=>ee(_).push("/user-login"))},g[2]||(g[2]=[s("span",{class:""},"Login to unlock",-1)]))):x("",!0)]),_:1},8,["src","ratio"])]),_:1},8,["to"]),o.showButtons?(l(),m("div",ce,[s("div",de,[i(le,{align:"left",class:"q-mx-none q-pa-none q-my-none"},{default:r(()=>[i(A,{flat:"",round:"",size:"md",color:O.value,icon:j.value,class:"q-ml-none",onClick:U},{default:r(()=>[C(u(M.value),1)]),_:1},8,["color","icon"]),i(A,{flat:"",round:"",size:"md",color:"primary",icon:"comment",class:"q-ml-sm"},{default:r(()=>[C(u(V.value),1)]),_:1}),s("div",me,"by "+u(z.value),1)]),_:1}),o.showPublishedDate?(l(),k(L,{key:0,class:"text-caption"},{default:r(()=>[C(u(P.value),1)]),_:1})):x("",!0)]),B.value.length>0&&o.showTags?(l(),k(L,{key:0},{default:r(()=>[(l(!0),m(D,null,N(B.value,w=>(l(),k(ne,{color:"primary","text-color":"white",key:w,class:"q-mx-xs q-px-sm"},{default:r(()=>[i(T,{to:G(w),style:{"text-decoration":"none",color:"white"}},{default:r(()=>[C(u(w.replace(/_/g," ")),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):x("",!0)])):x("",!0)]),_:1})}}}),ge={class:"text-h5"},ve={class:"row"},pe={class:"col-lg-2 col-md-3 col-sm-6"},fe={class:"col-lg-10 col-md-9 col-sm-6"},he={class:"q-mx-md"},_e=$({__name:"NovelThumbnailChapter",props:{chapterTitle:{default:""},coverImage:{default:""},description:{default:""}},setup(c){const p=q().isDebugMode;p&&console.debug("NovelThumbnail loaded");const a=c;return S(()=>{p&&console.debug("props",a)}),(_,b)=>(l(),m(D,null,[s("div",ge,u(a.chapterTitle),1),s("div",ve,[s("div",pe,[i(F,{imageId:a.coverImage,enableLinkToImageDetailView:!1,showTags:!1,showPublishedDate:!1,showButtons:!1,cropAspectRatio:1},null,8,["imageId"])]),s("div",fe,[s("div",he,u(a.description)+"... ",1)])])],64))}}),be={class:"row"},ke={class:"col-12 col-lg-6 mx-auto"},xe={class:"text-h4"},ye={class:"text-h5 q-my-sm"},Ie=$({__name:"NovelThumbnail",props:{novelTitle:{default:""},coverImage:{default:""},novelChapters:{},description:{default:""},novelId:{default:0}},setup(c){const p=q().isDebugMode;p&&console.debug("NovelThumbnail loaded");const a=c;return S(()=>{p&&console.debug(a)}),(_,b)=>(l(),m("div",be,[s("div",ke,[s("div",xe,u(a.novelTitle),1),i(F,{imageId:a.coverImage,showTags:!1,"crop-aspect-ratio":1},null,8,["imageId"]),s("div",ye,u(a.novelTitle),1),s("div",null,u(a.description),1),(l(!0),m(D,null,N(a.novelChapters,o=>(l(),m("div",{key:o.chapterTitle,class:"q-my-sm"},[i(ae,{class:"q-my-md"}),i(_e,{coverImage:o.coverImage!==void 0&&o.coverImage.length>0?o.coverImage:a.coverImage,description:o.description,chapterTitle:o.chapterTitle},null,8,["coverImage","description","chapterTitle"])]))),128))])]))}}),Te={key:0,class:"text-center"},we={class:"col-12 q-px-md q-py-md text-h5"},Ce=$({__name:"NovelHome",setup(c){const f=q();f.isDebugMode&&console.debug("uiConfigStore",`debug mode: ${f.isDebugMode}, `,`language: ${f.language}`);const a=v(!0),_=v(""),b=v([]);function o(){a.value=!0,Q.get(`/novels/search/${f.language}/`).then(e=>{const d=e.data;console.debug(d),b.value=d.map(n=>re(n)),a.value=!1}).catch(e=>{console.log(e)})}return S(()=>{o()}),(e,d)=>(l(),k(W,null,{default:r(()=>[d[1]||(d[1]=s("p",null,"Novels",-1)),a.value?(l(),m("div",Te,[i(K,{size:"50px",color:"primary"}),d[0]||(d[0]=s("p",null,"Loading...",-1))])):x("",!0),s("div",we,u(_.value),1),(l(!0),m(D,null,N(b.value,n=>(l(),m("div",{key:n.novelId,class:"col-12 q-px-md q-py-sm"},[i(Ie,{novelTitle:n.novelTitle,coverImage:n.coverImage,novelChapters:n.novelChapters,description:n.description,novelId:n.novelId},null,8,["novelTitle","coverImage","novelChapters","description","novelId"])]))),128))]),_:1}))}}),ze=ue(Ce,[["__scopeId","data-v-a0e4f0e6"]]);export{ze as default};
