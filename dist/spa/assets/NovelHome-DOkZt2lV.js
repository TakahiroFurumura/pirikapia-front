import{Q as J}from"./QSpinnerGears-5nJHivRm.js";import{Q as K}from"./QPage-B00lOnun.js";import{K as W,B as D,r as m,a as p,x as Q,w as X,C as w,D as r,E as n,G as i,F as S,S as Y,O as v,L as Z,M as ee,N as s,I,J as c,R as q,P as B}from"./index-B3FBFRuF.js";import{u as oe,a as $}from"./axios-OPDd6BiY.js";import{b as te,c as ae,Q as le,d as ne}from"./interfaces-DRXqv5tu.js";import{Q as A}from"./QBtn-5hWNu3NI.js";import{Q as F}from"./QCardSection-CjokqpGS.js";import{Q as re}from"./QCard-CvaxcUmE.js";import{_ as se}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./render-DC1yPiBO.js";import"./use-router-link-BNZ7x_Ga.js";import"./use-dark-CN2ppKrB.js";import"./use-timeout-ByJtgFeY.js";const N=W("uiConfigStore",{state:()=>({debugMode:!0,language:"jp"}),getters:{getLanguage:g=>g.language,isDebugMode:g=>g.debugMode},actions:{}}),ue={class:"text-caption q-ml-sm"},ie=D({__name:"ImageBox",props:{imageId:{},showTags:{type:Boolean,default:!0},cropAspectRatio:{default:null}},setup(g){const _=N().isDebugMode,t=oe(),h=ee(),b=new Intl.DateTimeFormat("en-US",{year:"numeric",month:"long",day:"numeric"}),a=g,e=m(null),u=m(!1),l=m(null),T=m([]),L=p(()=>e.value?.created_on?b.format(new Date(e.value?.created_on)):""),z=p(()=>0),E=p(()=>e.value!==null?e.value.owner_username:""),V=p(()=>a.cropAspectRatio!==null&&a.cropAspectRatio!==void 0?a.cropAspectRatio:e.value!==null&&e.value.width!==void 0&&e.value.height!==void 0?e.value.width/e.value.height:1),k=m(!1),x=m(!1),j=p(()=>k.value||x.value||M.value>0?"favorite":"favorite_border"),O=p(()=>k.value||x.value?"pink":"primary"),M=p(()=>e.value!=null&&e.value!==null?e.value.bookmark_count+(x.value?1:0):0);function P(o){return`/?tag=${o}`}const G=async()=>{await $.get(`/images/hashid/${a.imageId}/`).then(o=>{e.value=o.data,T.value=Object.keys(o.data.tags),k.value=o.data.bookmark}).catch(o=>{console.log(o)})},R=async()=>{u.value=!0,l.value=null,e.value=null;try{await G()}catch(o){console.error("Failed to load an image:",o),o instanceof Error?l.value=o:l.value=new Error(String(o))}finally{u.value=!1}};function H(){k.value||e.value!==null&&(console.debug(`toggleBookmark ${e.value.filename} ${t.user}`),t.isAuthenticated?$.post(`/images/bookmark/${e.value.image_id}/`,{}).then(()=>{console.debug(`added to ${t.user.username} bookmark.`),x.value=!0}).catch(o=>{console.error(o.message)}):h.push("/user-login"))}Q(()=>{_&&console.debug(a),R().catch(o=>console.error(o))}),X(()=>a.imageId,(o,d)=>{o!==d&&o&&(console.log(`Image ID changed from ${d} to ${o}. Reloading data.`),R().catch(y=>console.error(y)))});function U(){return`/image-detail-view/${a.imageId}`}return(o,d)=>{const y=Y("router-link");return r(),w(re,{flat:""},{default:n(()=>[i(y,{to:U()},{default:n(()=>[i(te,{src:e.value?.signed_url,"spinner-color":"grey",ratio:V.value,"spinner-size":"82px",style:{position:"relative"}},{error:n(()=>d[1]||(d[1]=[s("div",{class:"absolute-full flex flex-center bg-grey text-white"}," Failed to load... ",-1)])),default:n(()=>[e.value?.requires_login?(r(),v("div",{key:0,class:"absolute-full text-subtitle1 flex flex-center",style:{cursor:"pointer","background-color":"rgba(0, 0, 0, 0.3)",color:"white",padding:"2px"},onClick:d[0]||(d[0]=C=>Z(h).push("/user-login"))},d[2]||(d[2]=[s("span",{class:""},"Login to unlock",-1)]))):S("",!0)]),_:1},8,["src","ratio"])]),_:1},8,["to"]),i(ae,{align:"left",class:"q-mx-none q-pa-none q-my-none"},{default:n(()=>[i(A,{flat:"",round:"",size:"md",color:O.value,icon:j.value,class:"q-ml-none",onClick:H},{default:n(()=>[I(c(M.value),1)]),_:1},8,["color","icon"]),i(A,{flat:"",round:"",size:"md",color:"primary",icon:"comment",class:"q-ml-sm"},{default:n(()=>[I(c(z.value),1)]),_:1}),s("div",ue,"by "+c(E.value),1)]),_:1}),T.value.length>0&&a.showTags?(r(),w(F,{key:0},{default:n(()=>[(r(!0),v(q,null,B(T.value,C=>(r(),w(le,{color:"primary","text-color":"white",key:C,class:"q-mx-xs q-px-sm"},{default:n(()=>[i(y,{to:P(C),style:{"text-decoration":"none",color:"white"}},{default:n(()=>[I(c(C.replace(/_/g," ")),1)]),_:2},1032,["to"])]),_:2},1024))),128))]),_:1})):S("",!0),i(F,{class:"text-caption"},{default:n(()=>[I(c(L.value),1)]),_:1})]),_:1})}}}),ce={class:"row"},de={class:"col-12 col-lg-6 mx-auto"},me={class:"text-h4"},ge=D({__name:"NovelThumbnail",props:{novelTitle:{default:""},coverImage:{default:""},novelChapters:{},description:{default:""},novelId:{default:0}},setup(g){const _=N().isDebugMode;_&&console.debug("NovelThumbnail loaded");const t=g;return Q(()=>{_&&console.debug(t)}),(h,b)=>(r(),v("div",ce,[s("div",de,[s("div",me,c(t.novelTitle),1),i(ie,{imageId:t.coverImage,showTags:!1},null,8,["imageId"]),s("div",null,c(t.novelTitle),1),s("div",null,c(t.description),1),(r(!0),v(q,null,B(t.novelChapters,a=>(r(),v("div",{key:a.chapterTitle},[s("div",null,c(a.chapterTitle),1)]))),128))])]))}}),ve={key:0,class:"text-center"},pe={class:"col-12 q-px-md q-py-md text-h5"},fe=D({__name:"NovelHome",setup(g){const f=N();f.isDebugMode&&console.debug("uiConfigStore",`debug mode: ${f.isDebugMode}, `,`language: ${f.language}`);const t=m(!0),h=m(""),b=m([]);function a(){t.value=!0,$.get(`/novels/search/${f.language}/`).then(e=>{const u=e.data;console.debug(u),b.value=u.map(l=>ne(l)),t.value=!1}).catch(e=>{console.log(e)})}return Q(()=>{a()}),(e,u)=>(r(),w(K,null,{default:n(()=>[u[1]||(u[1]=s("p",null,"Novels",-1)),t.value?(r(),v("div",ve,[i(J,{size:"50px",color:"primary"}),u[0]||(u[0]=s("p",null,"Loading...",-1))])):S("",!0),s("div",pe,c(h.value),1),(r(!0),v(q,null,B(b.value,l=>(r(),v("div",{key:l.novelId,class:"col-12 q-px-md q-py-sm"},[i(ge,{novelTitle:l.novelTitle,coverImage:l.coverImage,novelChapters:l.novelChapters,description:l.description,novelId:l.novelId},null,8,["novelTitle","coverImage","novelChapters","description","novelId"])]))),128))]),_:1}))}}),Qe=se(fe,[["__scopeId","data-v-a0e4f0e6"]]);export{Qe as default};
