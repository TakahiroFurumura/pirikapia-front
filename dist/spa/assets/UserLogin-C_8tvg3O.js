import{Q as b,a as f,b as g}from"./QForm-CHBwPtrE.js";import{a as h}from"./QBtn-BZqyzzDW.js";import{Q as q}from"./QCardSection-DBV8wOnY.js";import{Q as C}from"./QCard-BarK22sE.js";import{Q as _}from"./QPage-IvwbS32v.js";import{i as B,a0 as N,B as A,r as n,b as L,M,C as v,E as o,D as y,G as l,N as u,I as d,a1 as x,F as V,J as Q}from"./index-BRBNf_uG.js";import{u as U,A as I,a as R}from"./axios-B-LYouSp.js";import"./use-dark-BiamoCnD.js";import"./render-AV_9SGo9.js";function z(){return B(N)}const W=A({__name:"UserLogin",setup(D){const t=n(""),m=n(""),i=n(!1),r=n(""),p=n(""),w=U(),c=M(),E=z(),k=async()=>{i.value=!0,r.value="";try{await w.login({email:t.value,username:t.value,password:m.value}),console.log("login success"),c.push("/").catch(s=>{console.error("navigation after logging in failed",s)})}catch(s){let a="Login failed. Please check your credentials or try again later.";if(s instanceof I)if(s.response&&s.response.data){const e=s.response.data;e&&typeof e.message=="string"?a=e.message:e&&typeof e.error=="string"?a=e.error:typeof e=="string"?a=e:s.message&&(a=s.message)}else s.request?a="No response from server. Please check your network connection.":a=s.message||"An unexpected error occurred during the request setup.";else s instanceof Error?a=s.message:typeof s=="string"&&(a=s);r.value=a,E.notify({color:"negative",position:"top",message:r.value,icon:"warning"})}finally{i.value=!1}},P=()=>{c.push("user-sign-up").catch(s=>console.log(s))},S=()=>{console.debug("sendPasswordResetEmail"),R.post("auth/password/reset/",{email:t.value}).then(s=>{console.debug(s),p.value="Email to reset your password was sent. Please check your mailbox."}).catch(s=>console.log(s))};return L(()=>{w.isAuthenticated&&c.push("user-profile")}),(s,a)=>(y(),v(_,{class:"flex"},{default:o(()=>[l(C,{flat:"",style:{width:"400px","max-width":"90vw"}},{default:o(()=>[l(q,null,{default:o(()=>[u("div",{class:"text-h5 q-mb-md"},[a[3]||(a[3]=d("Login or ")),u("a",{class:"",onClick:P},"sing up")]),l(b,{onSubmit:x(k,["prevent"])},{default:o(()=>[l(f,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),label:"Email",type:"email",filled:"","lazy-rules":"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],class:"q-mb-sm"},null,8,["modelValue","rules"]),l(f,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),label:"Password",type:"password",filled:"","lazy-rules":"",rules:[e=>!!e||"Password is required"],class:"q-mb-sm"},null,8,["modelValue","rules"]),r.value?(y(),v(g,{key:0,"inline-actions":"",class:"text-white bg-red q-mb-md"},{default:o(()=>[d(Q(r.value),1)]),_:1})):V("",!0),u("div",null,[l(h,{label:"Login",type:"submit",color:"primary",loading:i.value,class:"full-width"},null,8,["loading"])])]),_:1})]),_:1}),l(q,{class:"q-my-lg"},{default:o(()=>[l(g,{class:"q-my-none q-py-none q-px-none"},{default:o(()=>a[4]||(a[4]=[d("Forgot password?")])),_:1}),l(b,{onSubmit:x(S,["prevent"])},{default:o(()=>[l(f,{modelValue:t.value,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value=e),label:"Email",type:"email",filled:"","lazy-rules":"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],class:"q-mb-sm"},null,8,["modelValue","rules"]),u("div",null,[l(h,{label:"Send email to reset password",type:"submit",color:"primary",loading:i.value,class:"full-width"},null,8,["loading"])]),p.value?(y(),v(g,{key:0,"inline-actions":"",class:"text-white bg-red q-mb-md"},{default:o(()=>[d(Q(p.value),1)]),_:1})):V("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}});export{W as default};
