import{Q as f}from"./QInput-mqHnNfJz.js";import{Q as b,a as g}from"./QForm-CR8NjNuC.js";import{Q as h}from"./QBtn-CZIcCi6_.js";import{Q as q}from"./QCardSection-D1bofxnj.js";import{Q as _}from"./QCard-D1ll5pcf.js";import{Q as C}from"./QPage-CPZYKsue.js";import{v as L,ae as N,I as A,r as i,F as B,S as M,J as v,L as o,K as y,N as l,T as u,O as d,af as x,M as Q,P as V}from"./index-DIZdvslo.js";import{u as U,A as I,a as R}from"./auth-XbfXqh8a.js";import"./use-key-composition-ClTwYej7.js";import"./use-router-link-B_O56vdA.js";import"./use-dark-DQdLCcCG.js";function z(){return L(N)}const Y=A({__name:"UserLogin",setup(F){const t=i(""),m=i(""),n=i(!1),r=i(""),p=i(""),w=U(),c=M(),k=z(),E=async()=>{n.value=!0,r.value="";try{await w.login({email:t.value,username:t.value,password:m.value}),console.log("login success"),c.push("/").catch(s=>{console.error("navigation after logging in failed",s)})}catch(s){let a="Login failed. Please check your credentials or try again later.";if(s instanceof I)if(s.response&&s.response.data){const e=s.response.data;e&&typeof e.message=="string"?a=e.message:e&&typeof e.error=="string"?a=e.error:typeof e=="string"?a=e:s.message&&(a=s.message)}else s.request?a="No response from server. Please check your network connection.":a=s.message||"An unexpected error occurred during the request setup.";else s instanceof Error?a=s.message:typeof s=="string"&&(a=s);r.value=a,k.notify({color:"negative",position:"top",message:r.value,icon:"warning"})}finally{n.value=!1}},P=()=>{c.push("user-sign-up").catch(s=>console.log(s))},S=()=>{console.debug("sendPasswordResetEmail"),R.post("auth/password/reset/",{email:t.value}).then(s=>{console.debug(s),p.value="Email to reset your password was sent. Please check your mailbox."}).catch(s=>console.log(s))};return B(()=>{w.isAuthenticated&&c.push("user-profile")}),(s,a)=>(y(),v(C,{class:"flex"},{default:o(()=>[l(_,{flat:"",style:{width:"400px","max-width":"90vw"}},{default:o(()=>[l(q,null,{default:o(()=>[u("div",{class:"text-h5 q-mb-md"},[a[3]||(a[3]=d("Login or ")),u("a",{class:"",onClick:P},"sing up")]),l(b,{onSubmit:x(E,["prevent"])},{default:o(()=>[l(f,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),label:"Email",type:"email",filled:"","lazy-rules":"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],class:"q-mb-sm"},null,8,["modelValue","rules"]),l(f,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),label:"Password",type:"password",filled:"","lazy-rules":"",rules:[e=>!!e||"Password is required"],class:"q-mb-sm"},null,8,["modelValue","rules"]),r.value?(y(),v(g,{key:0,"inline-actions":"",class:"text-white bg-red q-mb-md"},{default:o(()=>[d(V(r.value),1)]),_:1})):Q("",!0),u("div",null,[l(h,{label:"Login",type:"submit",color:"primary",loading:n.value,class:"full-width"},null,8,["loading"])])]),_:1})]),_:1}),l(q,{class:"q-my-lg"},{default:o(()=>[l(g,{class:"q-my-none q-py-none q-px-none"},{default:o(()=>a[4]||(a[4]=[d("Forgot password?")])),_:1}),l(b,{onSubmit:x(S,["prevent"])},{default:o(()=>[l(f,{modelValue:t.value,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value=e),label:"Email",type:"email",filled:"","lazy-rules":"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],class:"q-mb-sm"},null,8,["modelValue","rules"]),u("div",null,[l(h,{label:"Send email to reset password",type:"submit",color:"primary",loading:n.value,class:"full-width"},null,8,["loading"])]),p.value?(y(),v(g,{key:0,"inline-actions":"",class:"text-white bg-red q-mb-md"},{default:o(()=>[d(V(p.value),1)]),_:1})):Q("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}});export{Y as default};
