import{Q as w,a as c,b as f}from"./QForm-SY3tUZtr.js";import{a as b}from"./QBtn-CXoXXZp2.js";import{Q as q}from"./QCardSection-B0MSBEah.js";import{Q as C}from"./QCard-P-w3-7Q9.js";import{Q as _}from"./QPage-RgZZihJR.js";import{i as B,$ as N,B as L,r as n,C as g,E as o,D as v,G as l,N as u,I as d,a0 as h,F as x,J as V,M as U}from"./index-B93gdOyN.js";import{u as A,A as I,a as M}from"./axios-9lw-yKz7.js";import"./vm-By5Vl5lB.js";import"./use-dark-CKMWxVT2.js";function R(){return B(N)}const O=L({__name:"UserLogin",setup(z){const t=n(""),m=n(""),i=n(!1),r=n(""),p=n(""),Q=A(),y=U(),E=R(),k=async()=>{i.value=!0,r.value="";try{await Q.login({email:t.value,username:t.value,password:m.value}),console.log("login success"),y.push("/").catch(s=>{console.error("navigation after logging in failed",s)})}catch(s){let a="Login failed. Please check your credentials or try again later.";if(s instanceof I)if(s.response&&s.response.data){const e=s.response.data;e&&typeof e.message=="string"?a=e.message:e&&typeof e.error=="string"?a=e.error:typeof e=="string"?a=e:s.message&&(a=s.message)}else s.request?a="No response from server. Please check your network connection.":a=s.message||"An unexpected error occurred during the request setup.";else s instanceof Error?a=s.message:typeof s=="string"&&(a=s);r.value=a,E.notify({color:"negative",position:"top",message:r.value,icon:"warning"})}finally{i.value=!1}},P=()=>{y.push("user-sign-up").catch(s=>console.log(s))},S=()=>{console.debug("sendPasswordResetEmail"),M.post("auth/password/reset/",{email:t.value}).then(s=>{console.debug(s),p.value="Email to reset your password was sent. Please check your mailbox."}).catch(s=>console.log(s))};return(s,a)=>(v(),g(_,{class:"flex"},{default:o(()=>[l(C,{flat:"",style:{width:"400px","max-width":"90vw"}},{default:o(()=>[l(q,null,{default:o(()=>[u("div",{class:"text-h5 q-mb-md"},[a[3]||(a[3]=d("Login or ")),u("a",{class:"",onClick:P},"sing up")]),l(w,{onSubmit:h(k,["prevent"])},{default:o(()=>[l(c,{modelValue:t.value,"onUpdate:modelValue":a[0]||(a[0]=e=>t.value=e),label:"Email",type:"email",filled:"","lazy-rules":"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],class:"q-mb-sm"},null,8,["modelValue","rules"]),l(c,{modelValue:m.value,"onUpdate:modelValue":a[1]||(a[1]=e=>m.value=e),label:"Password",type:"password",filled:"","lazy-rules":"",rules:[e=>!!e||"Password is required"],class:"q-mb-sm"},null,8,["modelValue","rules"]),r.value?(v(),g(f,{key:0,"inline-actions":"",class:"text-white bg-red q-mb-md"},{default:o(()=>[d(V(r.value),1)]),_:1})):x("",!0),u("div",null,[l(b,{label:"Login",type:"submit",color:"primary",loading:i.value,class:"full-width"},null,8,["loading"])])]),_:1})]),_:1}),l(q,{class:"q-my-lg"},{default:o(()=>[l(f,{class:"q-my-none q-py-none q-px-none"},{default:o(()=>a[4]||(a[4]=[d("Forgot password?")])),_:1}),l(w,{onSubmit:h(S,["prevent"])},{default:o(()=>[l(c,{modelValue:t.value,"onUpdate:modelValue":a[2]||(a[2]=e=>t.value=e),label:"Email",type:"email",filled:"","lazy-rules":"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],class:"q-mb-sm"},null,8,["modelValue","rules"]),u("div",null,[l(b,{label:"Send email to reset password",type:"submit",color:"primary",loading:i.value,class:"full-width"},null,8,["loading"])]),p.value?(v(),g(f,{key:0,"inline-actions":"",class:"text-white bg-red q-mb-md"},{default:o(()=>[d(V(p.value),1)]),_:1})):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1}))}});export{O as default};
