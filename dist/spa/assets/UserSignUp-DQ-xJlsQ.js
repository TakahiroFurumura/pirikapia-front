import{Q as m}from"./QInput-mqHnNfJz.js";import{Q as y,a as b}from"./QForm-CR8NjNuC.js";import{Q}from"./QBtn-CZIcCi6_.js";import{Q as V}from"./QCardSection-D1bofxnj.js";import{Q as h}from"./QCard-D1ll5pcf.js";import{Q as S}from"./QPage-CPZYKsue.js";import{I as x,r as t,J as p,L as o,K as f,N as s,T as c,af as q,M as U,O as _,P as B,S as C}from"./index-DIZdvslo.js";import{u as N,a as P}from"./auth-XbfXqh8a.js";import"./use-key-composition-ClTwYej7.js";import"./use-router-link-B_O56vdA.js";import"./use-dark-DQdLCcCG.js";const O=x({__name:"UserSignUp",setup(k){const v=N(),i=t(""),n=t(""),u=t(""),d=t(!1),l=t(""),g=C(),w=async()=>{d.value=!0,l.value="";try{const r={username:n.value,email:i.value,password1:u.value,password2:u.value};await P.post("/auth/registration/",r).then(a=>{a.status===201?(v._setAuthData(a.data.access,a.data.refresh,a.data.user),g.push("/").catch(e=>{console.error("navigation after logging in failed",e)})):l.value="Failed to create a new account. "+a.data.toString()}).catch(a=>{console.log(a),l.value="Failed to create a new account. ",a.response.data.email!==void 0&&(l.value+=a.response.data.email+" "),a.response.data.password!==void 0&&(l.value+=a.response.data.password+" "),a.response.data.username!==void 0&&(l.value+=a.response.data.username+" ")}).finally()}catch(r){console.log(r)}finally{d.value=!1}};return(r,a)=>(f(),p(S,{class:"flex"},{default:o(()=>[s(h,{flat:"",style:{width:"400px","max-width":"90vw"}},{default:o(()=>[s(V,null,{default:o(()=>[a[3]||(a[3]=c("div",{class:"text-h5 q-mb-md"},"Sing up",-1)),s(y,{onSubmit:q(w,["prevent"])},{default:o(()=>[s(m,{modelValue:i.value,"onUpdate:modelValue":a[0]||(a[0]=e=>i.value=e),label:"Email",type:"email",filled:"","lazy-rules":"",rules:[e=>!!e||"Email is required",e=>/.+@.+\..+/.test(e)||"Invalid email"],class:"q-mb-sm"},null,8,["modelValue","rules"]),s(m,{modelValue:n.value,"onUpdate:modelValue":a[1]||(a[1]=e=>n.value=e),label:"User name (displayed publicly)",type:"text",filled:"","lazy-rules":"",rules:[e=>!!e||"User name is required"],class:"q-mb-sm"},null,8,["modelValue","rules"]),s(m,{modelValue:u.value,"onUpdate:modelValue":a[2]||(a[2]=e=>u.value=e),label:"Password",type:"password",filled:"","lazy-rules":"",rules:[e=>!!e||"Password is required"],class:"q-mb-sm"},null,8,["modelValue","rules"]),l.value?(f(),p(b,{key:0,"inline-actions":"",class:"text-white bg-red q-mb-md"},{default:o(()=>[_(B(l.value),1)]),_:1})):U("",!0),c("div",null,[s(Q,{label:"Sign up",type:"submit",color:"primary",loading:d.value,class:"full-width"},null,8,["loading"])])]),_:1})]),_:1})]),_:1})]),_:1}))}});export{O as default};
