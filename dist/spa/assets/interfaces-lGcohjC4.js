import{u as U,d as W,b as X,Q as T,e as Y,v as R,h as P}from"./use-router-link-CXJhVG-O.js";import{R as Z,b as p,c as ee,d as te,Q as A}from"./QBtn-DoN1AH5E.js";import{u as oe,a as ie}from"./use-dark-vjAAQYj5.js";import{c as z,g as M,a as n,h as r,s as ne,r as k,A as ae,x as D,w as le,U as re,B as se,C as ue,D as L,E as _,G as q,S as ce,O as de,F as me,N as Q,I as V,J as $,M as ge}from"./index-DhwiOfWt.js";import{u as j}from"./use-timeout-k1DLVsQS.js";import{Q as fe}from"./QSeparator-CAFPWyfE.js";import{Q as ve}from"./QCard-DmV05GCp.js";import{u as he,a as be}from"./axios-BmQG2FxB.js";const _e={xs:8,sm:10,md:14,lg:20,xl:24},Ae=z({name:"QChip",props:{...oe,...U,dense:Boolean,icon:String,iconRight:String,iconRemove:String,iconSelected:String,label:[String,Number],color:String,textColor:String,modelValue:{type:Boolean,default:!0},selected:{type:Boolean,default:null},square:Boolean,outline:Boolean,clickable:Boolean,removable:Boolean,removeAriaLabel:String,tabindex:[String,Number],disable:Boolean,ripple:{type:[Boolean,Object],default:!0}},emits:["update:modelValue","update:selected","remove","click"],setup(e,{slots:u,emit:a}){const{proxy:{$q:i}}=M(),S=ie(e,i),d=W(e,_e),g=n(()=>e.selected===!0||e.icon!==void 0),f=n(()=>e.selected===!0?e.iconSelected||i.iconSet.chip.selected:e.icon),C=n(()=>e.iconRemove||i.iconSet.chip.remove),m=n(()=>e.disable===!1&&(e.clickable===!0||e.selected!==null)),v=n(()=>{const o=e.outline===!0&&e.color||e.textColor;return"q-chip row inline no-wrap items-center"+(e.outline===!1&&e.color!==void 0?` bg-${e.color}`:"")+(o?` text-${o} q-chip--colored`:"")+(e.disable===!0?" disabled":"")+(e.dense===!0?" q-chip--dense":"")+(e.outline===!0?" q-chip--outline":"")+(e.selected===!0?" q-chip--selected":"")+(m.value===!0?" q-chip--clickable cursor-pointer non-selectable q-hoverable":"")+(e.square===!0?" q-chip--square":"")+(S.value===!0?" q-chip--dark q-dark":"")}),c=n(()=>{const o=e.disable===!0?{tabindex:-1,"aria-disabled":"true"}:{tabindex:e.tabindex||0},B={...o,role:"button","aria-hidden":"false","aria-label":e.removeAriaLabel||i.lang.label.remove};return{chip:o,remove:B}});function l(o){o.keyCode===13&&s(o)}function s(o){e.disable||(a("update:selected",!e.selected),a("click",o))}function h(o){(o.keyCode===void 0||o.keyCode===13)&&(ne(o),e.disable===!1&&(a("update:modelValue",!1),a("remove")))}function y(){const o=[];m.value===!0&&o.push(r("div",{class:"q-focus-helper"})),g.value===!0&&o.push(r(T,{class:"q-chip__icon q-chip__icon--left",name:f.value}));const B=e.label!==void 0?[r("div",{class:"ellipsis"},[e.label])]:void 0;return o.push(r("div",{class:"q-chip__content col row no-wrap items-center q-anchor--skip"},Y(u.default,B))),e.iconRight&&o.push(r(T,{class:"q-chip__icon q-chip__icon--right",name:e.iconRight})),e.removable===!0&&o.push(r(T,{class:"q-chip__icon q-chip__icon--remove cursor-pointer",name:C.value,...c.value.remove,onClick:h,onKeyup:h})),o}return()=>{if(e.modelValue===!1)return;const o={class:v.value,style:d.value};return m.value===!0&&Object.assign(o,c.value.chip,{onClick:s,onKeyup:l}),X("div",o,y(),"ripple",e.ripple!==!1&&e.disable!==!0,()=>[[Z,e.ripple]])}}}),ke={ratio:[String,Number]};function Se(e,u){return n(()=>{const a=Number(e.ratio||(u!==void 0?u.value:void 0));return isNaN(a)!==!0&&a>0?{paddingBottom:`${100/a}%`}:null})}const ye=1.7778,qe=z({name:"QImg",props:{...ke,src:String,srcset:String,sizes:String,alt:String,crossorigin:String,decoding:String,referrerpolicy:String,draggable:Boolean,loading:{type:String,default:"lazy"},loadingShowDelay:{type:[Number,String],default:0},fetchpriority:{type:String,default:"auto"},width:String,height:String,initialRatio:{type:[Number,String],default:ye},placeholderSrc:String,errorSrc:String,fit:{type:String,default:"cover"},position:{type:String,default:"50% 50%"},imgClass:String,imgStyle:Object,noSpinner:Boolean,noNativeMenu:Boolean,noTransition:Boolean,spinnerColor:String,spinnerSize:String},emits:["load","error"],setup(e,{slots:u,emit:a}){const i=k(e.initialRatio),S=Se(e,i),d=M(),{registerTimeout:g,removeTimeout:f}=j(),{registerTimeout:C,removeTimeout:m}=j(),v=n(()=>e.placeholderSrc!==void 0?{src:e.placeholderSrc}:null),c=n(()=>e.errorSrc!==void 0?{src:e.errorSrc,__qerror:!0}:null),l=[k(null),k(v.value)],s=k(0),h=k(!1),y=k(!1),o=n(()=>`q-img q-img--${e.noNativeMenu===!0?"no-":""}menu`),B=n(()=>({width:e.width,height:e.height})),O=n(()=>`q-img__image ${e.imgClass!==void 0?e.imgClass+" ":""}q-img__image--with${e.noTransition===!0?"out":""}-transition q-img__image--`),E=n(()=>({...e.imgStyle,objectFit:e.fit,objectPosition:e.position}));function F(){if(m(),e.loadingShowDelay===0){h.value=!0;return}C(()=>{h.value=!0},e.loadingShowDelay)}function x(){m(),h.value=!1}function H({target:t}){R(d)===!1&&(f(),i.value=t.naturalHeight===0?.5:t.naturalWidth/t.naturalHeight,N(t,1))}function N(t,b){b===1e3||R(d)===!0||(t.complete===!0?K(t):g(()=>{N(t,b+1)},50))}function K(t){R(d)!==!0&&(s.value=s.value^1,l[s.value].value=null,x(),t.getAttribute("__qerror")!=="true"&&(y.value=!1),a("load",t.currentSrc||t.src))}function G(t){f(),x(),y.value=!0,l[s.value].value=c.value,l[s.value^1].value=v.value,a("error",t)}function I(t){const b=l[t].value,w={key:"img_"+t,class:O.value,style:E.value,alt:e.alt,crossorigin:e.crossorigin,decoding:e.decoding,referrerpolicy:e.referrerpolicy,height:e.height,width:e.width,loading:e.loading,fetchpriority:e.fetchpriority,"aria-hidden":"true",draggable:e.draggable,...b};return s.value===t?Object.assign(w,{class:w.class+"current",onLoad:H,onError:G}):w.class+="loaded",r("div",{class:"q-img__container absolute-full",key:"img"+t},r("img",w))}function J(){return h.value===!1?r("div",{key:"content",class:"q-img__content absolute-full q-anchor--skip"},P(u[y.value===!0?"error":"default"])):r("div",{key:"loading",class:"q-img__loading absolute-full flex flex-center"},u.loading!==void 0?u.loading():e.noSpinner===!0?void 0:[r(p,{color:e.spinnerColor,size:e.spinnerSize})])}{let t=function(){le(()=>e.src||e.srcset||e.sizes?{src:e.src,srcset:e.srcset,sizes:e.sizes}:null,b=>{f(),y.value=!1,b===null?(x(),l[s.value^1].value=v.value):F(),l[s.value].value=b},{immediate:!0})};ae.value===!0?D(t):t()}return()=>{const t=[];return S.value!==null&&t.push(r("div",{key:"filler",style:S.value})),l[0].value!==null&&t.push(I(0)),l[1].value!==null&&t.push(I(1)),t.push(r(re,{name:"q-transition--fade"},J)),r("div",{key:"main",class:o.value,style:B.value,role:"img","aria-label":e.alt},t)}}}),Ce=z({name:"QCardActions",props:{...ee,vertical:Boolean},setup(e,{slots:u}){const a=te(e),i=n(()=>`q-card__actions ${a.value} q-card__actions--${e.vertical===!0?"vert column":"horiz row"}`);return()=>r("div",{class:i.value},P(u.default))}}),Be={key:0,class:"absolute-bottom text-center",style:{"background-color":"rgba(0, 0, 0, 0.3)",color:"white",padding:"2px"}},we={class:"text-caption q-ml-sm"},Le=se({__name:"ImageThumbnail",props:{filename:{},image_id:{},signed_url:{},owner_username:{},title:{default:""},comment_count:{default:0},requires_login:{type:Boolean},bookmark:{type:Boolean},bookmark_count:{default:0}},setup(e){const u=ge(),a=he(),i=e,S=n(()=>i.bookmark_count+(d.value?1:0)),d=k(!1),g=n(()=>i.bookmark!=null?!1:i.bookmark),f=n(()=>g.value||i.bookmark_count>0?"favorite":"favorite_border"),C=n(()=>g.value?"pink":"primary");function m(){return`/image-detail-view/${i.image_id}`}function v(){g.value||(console.debug(`toggleBookmark ${i.filename} ${a.user}`),a.isAuthenticated?be.post(`images/bookmark/${i.image_id}/`,{}).then(c=>{console.debug(`${c.status} ${i.filename} was added to ${a.user.username} bookmark.`),d.value=!0}).catch(c=>{console.error(c.message)}):u.push("/user-login"))}return D(()=>{}),(c,l)=>{const s=ce("router-link");return L(),ue(ve,{flat:"",class:"q-ma-none q-pa-none",style:{cursor:"pointer"}},{default:_(()=>[q(s,{to:m()},{default:_(()=>[q(qe,{src:i.signed_url,ratio:1/1,style:{position:"relative"}},{error:_(()=>l[0]||(l[0]=[Q("div",{class:"absolute-full flex flex-center bg-grey text-white"}," Failed to load... ",-1)])),default:_(()=>[c.requires_login?(L(),de("div",Be,l[1]||(l[1]=[Q("span",{class:"text-caption"},"Login to unlock",-1)]))):me("",!0)]),_:1},8,["src"])]),_:1},8,["to"]),q(fe),q(Ce,{align:"left",class:"q-mx-none q-pa-none q-my-none"},{default:_(()=>[q(A,{flat:"",round:"",size:"md",color:C.value,icon:f.value,class:"q-ml-none",onClick:v},{default:_(()=>[V($(S.value),1)]),_:1},8,["color","icon"]),q(A,{flat:"",round:"",size:"md",color:"primary",icon:"comment",class:"q-ml-sm"},{default:_(()=>[V($(i.comment_count),1)]),_:1}),Q("div",we,"by "+$(i.owner_username),1)]),_:1})]),_:1})}}});function Ve(e){return{filename:e.filename,image_id:e.image_id,signed_url:e.signed_url,owner_username:e.owner_username,title:"",favorite_count:0,comment_count:0,requires_login:e.requires_login,bookmark:e.bookmark,bookmark_count:e.bookmark_count}}export{Ae as Q,Le as _,Ve as a,qe as b,Ce as c};
